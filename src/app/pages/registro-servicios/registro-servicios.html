<div class="background">
  <div class="light-wrapper ">
    <div class="card-form ">

      <h2 class="text-center mb-4 fw-bold " style= "color: #a04938">Servicios</h2>
      <form #formServ="ngForm" (ngSubmit)="onSubmit(formServ)" class="row g-4" novalidate>

        <div class="form-alert" *ngIf="formServ.submitted && formServ.invalid">
          Por favor, completa correctamente los campos requeridos.
        </div>

        <!-- NOMBRE SERVICIO -->
        <div class="col-12 position-relative">
          <label class="form-label fw-semibold">Nombre del servicio</label>
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-pencil-square"></i></span>
            <input type="text" class="form-control clean-input" placeholder="Ej: Baño completo, Consulta médica..."
              name="nombre_servicio" [(ngModel)]="model.nombre_servicio" required minlength="2"
              #nombre_servicio="ngModel" />
          </div>
          <small class="error-msg"
            *ngIf="nombre_servicio.invalid && (nombre_servicio.dirty || nombre_servicio.touched)">
            <span *ngIf="nombre_servicio.errors?.['required']">El nombre del servicio es obligatorio</span>
            <span *ngIf="nombre_servicio.errors?.['minlength']">Debe tener al menos 2 caracteres</span>
          </small>
        </div>

        <!-- DESCRIPCIÓN -->
        <div class="col-12 position-relative">
          <label class="form-label fw-semibold">Descripción</label>
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-card-text"></i></span>
            <textarea class="form-control clean-input" rows="3" name="descripcion"
              placeholder="Escribe una descripción detallada del servicio..." [(ngModel)]="model.descripcion" required
              minlength="5" #descripcion="ngModel"></textarea>
          </div>
          <small class="error-msg" *ngIf="descripcion.invalid && (descripcion.dirty || descripcion.touched)">
            <span *ngIf="descripcion.errors?.['required']">La descripción es obligatoria</span>
            <span *ngIf="descripcion.errors?.['minlength']">Debe tener al menos 5 caracteres</span>
          </small>
        </div>

        <!-- PRECIO -->
        <div class="col-sm-6 position-relative">
          <label class="form-label fw-semibold">Precio</label>
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-currency-dollar"></i></span>
            <input type="number" class="form-control clean-input" placeholder="Ej: 250" name="precio"
              [(ngModel)]="model.precio" required min="1" #precio="ngModel" />
          </div>
          <small class="error-msg" *ngIf="precio.invalid && (precio.dirty || precio.touched)">
            <span *ngIf="precio.errors?.['required']">El precio es obligatorio</span>
            <span *ngIf="precio.errors?.['min']">Debe ser mayor a 0</span>
          </small>
        </div>

        <!-- FECHA -->
        <div class="col-sm-6 position-relative">
          <label class="form-label fw-semibold">Fecha</label>
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-calendar-event"></i></span>
            <input type="datetime-local" class="form-control clean-input" name="fecha" [(ngModel)]="model.fecha"
              required #fecha="ngModel" />
          </div>
          <small class="error-msg" *ngIf="fecha.invalid && (fecha.dirty || fecha.touched)">
            <span *ngIf="fecha.errors?.['required']">La fecha es obligatoria</span>
          </small>
        </div>

        <!-- DURACIÓN -->
        <div class="col-sm-6 position-relative">
          <label class="form-label fw-semibold">Duración</label>
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-clock"></i></span>
            <input type="text" class="form-control clean-input" name="duracion" placeholder="Ej: 1 hora"
              [(ngModel)]="model.duracion" required minlength="2" #duracion="ngModel" />
          </div>
          <small class="error-msg" *ngIf="duracion.invalid && (duracion.dirty || duracion.touched)">
            <span *ngIf="duracion.errors?.['required']">La duración es obligatoria</span>
            <span *ngIf="duracion.errors?.['minlength']">Debe tener al menos 2 caracteres</span>
          </small>
        </div>

        <!-- CATEGORÍA -->
        <div class="col-sm-6 position-relative">
          <label class="form-label fw-semibold">Categoría</label>
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-list-task"></i></span>
            <select class="form-select clean-input" name="categoria" [(ngModel)]="model.categoria" required
              #categoria="ngModel">
              <option disabled selected value="">Seleccione una categoría...</option>
              <option>Consulta</option>
              <option>Baño</option>
              <option>Estética</option>
              <option>Cirugía</option>
              <option>Urgencias</option>
            </select>
          </div>
          <small class="error-msg" *ngIf="categoria.invalid && (categoria.dirty || categoria.touched)">
            Selecciona una categoría
          </small>
        </div>
        <!-- MASCOTA -->
        <div class="col-12 col-sm-6 position-relative">
          <label class="form-label fw-semibold">Mascota</label>
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-search"></i></span>
            <input type="text" class="form-control clean-input" placeholder="Buscar mascota por nombre..."
              [(ngModel)]="nombreMascota" (input)="filtrarMascotas()" name="mascotaBusqueda" autocomplete="off" required
              #mascota="ngModel" />
          </div>
          <small class="error-msg" *ngIf="mascota.invalid && (mascota.dirty || mascota.touched)">
            Selecciona una mascota
          </small>

          <ul *ngIf="mostrarLista && mascotasFiltradas.length > 0" class="list-group mt-1 shadow-sm dropdown-light">
            <li *ngFor="let m of mascotasFiltradas" (click)="seleccionarMascota(m)"
              class="list-group-item dropdown-item-light">
              {{ m.nombre }} — Propietario: {{ m.nombre_propietario }}
            </li>
          </ul>
        </div>

        <!-- VETERINARIO -->
        <div class="col-12 col-sm-6 position-relative">
          <label class="form-label fw-semibold">Veterinario</label>
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-people-fill"></i></span>
            <select class="form-select clean-input" name="Id_vet" [(ngModel)]="model.Id_vet" required #vet="ngModel">
              <option disabled selected value="">Seleccione un veterinario...</option>
              <option *ngFor="let v of veterinarios" [value]="v.Id_vet">
                {{ v.nombre_completo }} (ID: {{ v.Id_vet }})
              </option>
            </select>
          </div>
          <small class="error-msg" *ngIf="vet.invalid && (vet.dirty || vet.touched)">
            Selecciona un veterinario
          </small>
        </div>

        <!-- ESTADO -->
        <div class="col-12 col-sm-6  position-relative">
          <label class="form-label fw-semibold">Estado</label>
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-patch-check"></i></span>
            <select class="form-select clean-input" name="estado" [(ngModel)]="model.estado" required #estado="ngModel">
              <option disabled selected value="">Seleccione el estado...</option>
              <option>Pendiente</option>
              <option>Realizado</option>
              <option>Cancelado</option>
            </select>
          </div>
          <small class="error-msg" *ngIf="estado.invalid && (estado.dirty || estado.touched)">
            Selecciona el estado del servicio
          </small>
        </div>

        <div class="col-12 text-center">
          <button type="submit" class="btn btn-primary px-5 py-2 rounded-pill mt-3" [disabled]="formServ.invalid">
            Guardar Servicio
          </button>
        </div>

      </form>
    </div>
  </div>
</div>
